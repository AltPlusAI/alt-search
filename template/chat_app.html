<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">


    <title>chat app - Bootdey.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sample.css') }}">

</head>

<body>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <div class="container">
        <div class="row clearfix">
            <div class="col-lg-6">
                <div class="card chat-app">
                    <div id="plist" class="people-list">
                        <div class="input-group" style="position: sticky; z-index: 999; top: 0;">
                            <div class="input-group-prepend">
                                <button id="searchbtn" type="submit" onclick="sendResults()"> <span
                                        class="input-group-text"><i class="fa fa-search"></i></span></button>
                            </div>
                            <!-- <button onclick="sendChat()" type="submit" id="submit"><span class="input-group-text"><i
                                        class="fa fa-send"></i></span></button> -->
                            <input type="text" id="searchquery" class="form-control" placeholder="Search...">
                        </div>
                        <ul class="list-unstyled chat-list mt-2 mb-0" id="searchlist">
                            <li class="clearfix" id="list0" onclick="selectLink(this.id,'0')">
                                <div class="about">
                                    <div class="name" id="name0"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix" id="list1" onclick="selectLink(this.id,'1')">
                                <div class="about">
                                    <div class="name" id="name1"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix" id="list2" onclick="selectLink(this.id,'2')">
                                <div class="about">
                                    <div class="name" id="name2"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix" id="list3" onclick="selectLink(this.id,'3')">
                                <div class="about">
                                    <div class="name" id="name3"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix" id="list4" onclick="selectLink(this.id,'4')">
                                <div class="about">
                                    <div class="name" id="name4"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online </div>
                                </div>
                            </li>
                            <li class="clearfix" id="list5" onclick="selectLink(this.id,'5')">
                                <div class="about">
                                    <div class="name" id="name5"></div>
                                    <div class="status"> <i class="fa fa-circle online"></i> online
                                    </div>
                                </div>
                            </li>
                            <li class="clearfix">
                                <button id="selectbtn" type="submit" onclick="sendUrl(urllist)"> <span
                                        class="input-group-text"><i class="fa fa-list-alt"> Select and
                                            Summarize</i></span></button>
                            </li>
                        </ul>
                    </div>
                    <div class="chat">
                        <div class="chat-header clearfix"
                            style="position: sticky; z-index: 999; top: 0; background-color: #ffff;">
                            <div class="row">
                                <div class="col-lg-6">
                                    <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                                        <img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="avatar">
                                    </a>
                                    <div class="chat-about">
                                        <h6 class="m-b-0">Aiden Chavez</h6>
                                        <small>Last seen: 2 hours ago</small>
                                    </div>
                                </div>
                                <div class="col-lg-6 hidden-sm text-right">
                                    <a href="javascript:void(0);" class="btn btn-outline-secondary"><i
                                            class="fa fa-camera"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-primary"><i
                                            class="fa fa-image"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-info"><i
                                            class="fa fa-cogs"></i></a>
                                    <a href="javascript:void(0);" class="btn btn-outline-warning"><i
                                            class="fa fa-question"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="chat-history">
                            <ul class="m-b-0" id="chatlist">
                                <li class="clearfix">
                                    <div class="message-data text-right">
                                        <span class="message-data-time">10:10 AM, Today</span>
                                        <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="avatar">
                                    </div>
                                    <div class="message other-message float-right"> Hi Aiden, how are you? How is the
                                        project coming along? </div>
                                </li>
                                <li class="clearfix">
                                    <div class="message-data">
                                        <span class="message-data-time">10:12 AM, Today</span>
                                    </div>
                                    <div class="message my-message">Are we meeting today?</div>
                                </li>
                                <li class="clearfix">
                                    <div class="message-data">
                                        <span class="message-data-time">10:15 AM, Today</span>
                                    </div>
                                    <div class="message my-message">Project has been already finished and I have results
                                        to show you.</div>
                                </li>
                            </ul>
                        </div>
                        <div class="chat-message clearfix"
                            style="position: absolute; bottom: 0px; ; width: 800px;color: #ffff;">
                            <div class="input-group mb-0">
                                <div class="input-group-prepend">
                                    <!-- <button onclick="sendChat()" type="submit" id="submit"><span
                                            class="input-group-text"><i class="fa fa-send"></i></span></button> -->
                                </div>
                                <input type="text" class="form-control" id="qnaquery" placeholder="Enter text here...">
                                <button onclick="sendChat()" type="submit" id="submit"><span class="input-group-text"><i
                                            class="fa fa-send"></i></span></button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var urllist = []
        // select the list item
        function selectLink(id, num) {
            console.log(id)
            var list0 = document.getElementById(id)
            list0.className = "clearfix active"
            var link = document.getElementById("url" + num)
            urllist[0] = String(link.getAttribute("href"))
            console.log(String(link.getAttribute("href")))

        }
        async function sendResults() {
            input = document.getElementById('searchquery');
            submit = document.getElementById('searchbtn')

            // var list = document.getElementById("searchlist")
            // var entry = document.createElement('li');
            // entry.className = "clearfix";
            // var about = document.createElement('div')
            // about.className = "about"
            // var name= document.createElement('div')
            // name.className="name"
            // var description= document.createElement("div")
            // description.className="status"
            // description.textContent= "jeu"
            // about.appendChild(name)
            // about.appendChild(description)
            // entry.appendChild(about)
            // list.appendChild(entry);


            const response = await fetch('http://127.0.0.1:5000/searchResults', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Connection': 'keep-alive'
                },
                body: JSON.stringify({ "text": input.value, "max_words": 100 })
            })

            input.value = ""
            const obj = await response.json()
            name0 = document.getElementById("name0")
            name1 = document.getElementById("name1")
            name2 = document.getElementById("name2")
            name3 = document.getElementById("name3")
            name4 = document.getElementById("name4")
            name5 = document.getElementById("name5")

            name0.innerHTML = ''
            name1.innerHTML = ''
            name2.innerHTML = ''
            name3.innerHTML = ''
            name4.innerHTML = ''
            name5.innerHTML = ''

            link0 = document.createElement('a')
            link1 = document.createElement('a')
            link2 = document.createElement('a')
            link3 = document.createElement('a')
            link4 = document.createElement('a')
            link5 = document.createElement('a')
            var linkText0 = document.createTextNode(obj.url1);
            link0.appendChild(linkText0)
            var linkText1 = document.createTextNode(obj.url3);
            link1.appendChild(linkText1)
            var linkText2 = document.createTextNode(obj.url5);
            link2.appendChild(linkText2)
            var linkText3 = document.createTextNode(obj.url7);
            link3.appendChild(linkText3)
            var linkText4 = document.createTextNode(obj.url9);
            link4.appendChild(linkText4)
            var linkText5 = document.createTextNode(obj.url11);
            link5.appendChild(linkText5)

            link0.id = "url0"
            link1.id = "url1"
            link2.id = "url2"
            link3.id = "url3"
            link4.id = "url4"
            link5.id = "url5"
            link0.href = obj.url0
            link0.title = obj.url1
            link1.href = obj.url2
            link1.title = obj.url3
            link2.href = obj.url4
            link2.title = obj.url5
            link3.href = obj.url6
            link3.title = obj.url7
            link4.href = obj.url8
            link4.title = obj.url9
            link5.href = obj.url10
            link5.title = obj.url11

            name0.appendChild(link0)
            name1.appendChild(link1)

            name2.appendChild(link2)
            name3.appendChild(link3)
            name4.appendChild(link4)
            name5.appendChild(link5)

            // name0.innerHTML=obj.url0
            // name1.innerHTML=obj.url2
            // name2.innerHTML=obj.url4
            // name3.innerHTML=obj.url6            
            // name4.innerHTML=obj.url8
            // name5.innerHTML=obj.url10


            console.log(obj)
            // sendUrl(obj.url0)
        }
        async function sendUrl(url) {
            input = document.getElementById('qnaquery');
            submit = document.getElementById('submit')

            var list = document.getElementById("chatlist")
            var entry = document.createElement('li');
            const response = await fetch('http://127.0.0.1:5000/url', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Connection': 'keep-alive'
                },
                body: JSON.stringify({ "text": url[0], "text2": url[1], "max_words": 100 })
            })
            var obj = await response.json()
            console.log(obj.summary)
            var list = document.getElementById("chatlist")
            var entry = document.createElement('li');
            entry.className = "clearfix";
            msg = document.createElement('div')
            msg.className = "message my-message"
            msg.textContent = obj.summary
            entry.appendChild(msg);
            list.appendChild(entry);
        }
        // Chat Qna query javascript
        async function sendChat() {
            input = document.getElementById('qnaquery');
            submit = document.getElementById('submit')

            var list = document.getElementById("chatlist")
            var entry = document.createElement('li');
            entry.className = "clearfix";
            msg = document.createElement('div')
            msg.className = "message other-message float-right"
            msg.textContent = input.value
            entry.appendChild(msg);
            list.appendChild(entry);


            const response = await fetch('http://127.0.0.1:5000/qnaResults', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'Connection': 'keep-alive'
                },
                body: JSON.stringify({ "text": input.value, "max_words": 100 })
            })
            input.value = ""
            const obj = await response.json()
            if (obj.status == 200) {
                var list = document.getElementById("chatlist")
                var entry = document.createElement('li');
                entry.className = "clearfix";
                msg = document.createElement('div')
                msg.className = "message my-message"
                msg.textContent = obj.summary
                entry.appendChild(msg);
                list.appendChild(entry);
                input.value = ""
            }
            console.log(obj.summary)
        }
    </script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">

    </script>
</body>

</html>